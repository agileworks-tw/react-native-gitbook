# VM ä½¿ç”¨æ•™å­¸

## å–å¾— VM ç›¸é—œæª”æ¡ˆ

è·Ÿè¬›å¸«é ˜å–éš¨èº«ç¢Ÿæˆ–é€éç¶²è·¯ä¸‹è¼‰

## å‰ç½®æº–å‚™

- å®‰è£ `VirtualBox (version 6.0.10)` å’Œ `Genymotion (version 3.0.2)`

  - Windows:

    > å¾ ReactNative æ•™æä¸­çš„ `Windows` è³‡æ–™å¤¾ä¸­å¯ä»¥æ‰¾åˆ° Genymotion å®‰è£æª”ï¼ˆgenymotion-3.0.2-vboxï¼‰ï¼ŒWindows çš„ Genymotion å®‰è£æª”å·²ç¶“åŒ…å« VirtualBoxï¼Œç›´æ¥å®‰è£å³å¯

  - macOS:

    >  è«‹åˆ° ReactNative æ•™æä¸­çš„ `Mac` è³‡æ–™å¤¾ä¸­å¯ä»¥æ‰¾åˆ° VirtualBox å®‰è£æª”ä¾†é€²è¡Œå®‰è£ï¼Œå®‰è£å®Œ VirtualBox å¾Œï¼Œå†ä½¿ç”¨åŒè³‡æ–™å¤¾ä¸­çš„ Genymotion å®‰è£æª”ä¾†å®‰è£ Genymotion

- æ‰“é–‹ VirtualBox ï¼ŒåŒ¯å…¥æ•™æä¸­çš„ Android æ¨¡æ“¬å™¨æª”æ¡ˆ `Custom Phone - 7.1.0 - API 25 - 768x1280_with_GApps`

- åœ¨ VirtualBox ä¸­åŒ¯å…¥æ•™æä¸­çš„å¦ä¸€å€‹ ReactNative ç’°å¢ƒè™›æ“¬æ©Ÿæª”æ¡ˆ `ReactNative.ova`

![import-ReactNative-ova.png](assets/import-ReactNative-ova.png)

## VM ç’°å¢ƒè¨­å®š

ç’°å¢ƒä½¿ç”¨æ•™å­¸å½±ç‰‡: [https://youtu.be/2m7YyRycMhE](https://youtu.be/2m7YyRycMhE)
**è«‹ä¾ç…§é †åºæ“ä½œ**

### å•Ÿå‹•æ¨¡æ“¬å™¨èˆ‡è™›æ“¬æ©Ÿ

1. é–‹å•Ÿ Genymotionï¼ˆéœ€è¦è¨»å†Šï¼š[https://cloud.geny.io](https://cloud.geny.io))

2. Usage é¸æ“‡ `Personal Use`
  ![å€‹äººä½¿ç”¨æ–¹æ¡ˆ](assets/genymotion-personal-use.png)

3.  é–‹å•Ÿ Genymotion ç•¶ä¸­çš„ Android æ¨¡æ“¬å™¨ **Custom Phone - 7.1.0 - API 25 - 768x1280**ï¼Œç­‰å¾…é–‹æ©Ÿå®Œæˆ (å¦‚æœæ²’æœ‰çœ‹è¦‹ Android æ¨¡æ“¬å™¨ï¼Œå¯èƒ½æ˜¯åœ¨åŒ¯å…¥å®Œæˆå‰å°±å·²ç¶“é–‹å•Ÿ Genymotionï¼Œè«‹é‡é–‹ Genymotion)
![](assets/genymotion-virtual-device-list.png)

4.  é–‹å•Ÿ VirtualBox ç•¶ä¸­çš„ ReactNative è™›æ“¬æ©Ÿï¼Œå¾…è™›æ“¬æ©Ÿå‡ºç¾ login å­—æ¨£å¾Œï¼Œè¡¨ç¤ºå·²ç¶“æˆåŠŸå•Ÿå‹•ï¼Œé€™é‚Šä¸éœ€ç†æœƒç™»å…¥è¨Šæ¯ï¼Œä¹Ÿä¸éœ€åšç™»å…¥å‹•ä½œï¼Œæ¥ä¸‹ä¾†è«‹ç”¨ç€è¦½å™¨é–‹å•Ÿç¶²å€ http://localhost:9083/ide.htmlï¼Œé€™æ˜¯å‰›å‰›å•Ÿå‹•çš„è™›æ“¬æ©Ÿæ›è¼‰çš„ç¶²é æ“ä½œä»‹é¢

    ä¹‹å¾Œéƒ½æœƒé€éé€™å€‹é é¢ä¾†é€²è¡Œè™›æ“¬æ©Ÿå…§çš„æ“ä½œ
    ![launch-ReactNative-virtual-machine](assets/launch-ReactNative-virtual-machine.png)

    ![React Native è™›æ“¬æ©Ÿå•Ÿå‹•å°±ç·’](assets/vm-ready.png)

###  å°‡æ¨¡æ“¬å™¨é€£æ¥åˆ° ReactNative VM ç’°å¢ƒ

> **æ­¤å‹•ä½œæ¯æ¬¡é‡å•Ÿ Genymotion è£ç½®æˆ– ReactNative VM éƒ½éœ€è¦é‡åšä¸€æ¬¡!!!**

1. å–å¾— android è£ç½®IPä½å€

   ## åŸ·è¡Œæ‰¹æ¬¡æŒ‡ä»¤

   #### Windows

   æ‰“é–‹ `ReactNativeæ•™æ/Windows/android_device.bat` ï¼ŒåŸ·è¡Œè¦–çª—æœƒåˆ—å‡ºæ‰¾åˆ°çš„ android è£ç½® IPï¼Œå°‡ IP ä½å€è¤‡è£½ä¸‹ä¾†

   #### macOS

   æ‰“é–‹ terminal

   ```sh
   cd ReactNativeæ•™æ/Mac
   ./android_device.sh
   ```

   å°‡åŸ·è¡Œçµæœé¡¯ç¤ºçš„ IP ä½å€è¤‡è£½ä¸‹ä¾†

2.  åˆ° `ReactNative è™›æ“¬æ©Ÿç¶²é ç•¶ä¸­çš„ terminal` è¦–çª—è¼¸å…¥æŒ‡ä»¤

```bash
$ adb connect $ip:5556
# $ip è«‹è‡ªè¡Œæ›¿æ›ç‚º adb devices å›å‚³çš„ Android è™›æ“¬æ©Ÿ IP ä¾‹å¦‚:
# adb connect 192.168.57.101:5556

# æ¸¬è©¦æ˜¯å¦æœ‰é€£ä¸Š
$ adb devices
```

![](assets/cloud9-terminal.png)


## å®‰è£å•é¡Œ

### adb ç‰ˆæœ¬è¡çª (adb server version doesn't match this client killing...)

!!!  è«‹å…ˆåˆ° ä¸€èˆ¬ç’°å¢ƒè¨­å®šç« ç¯€ ç¢ºèª Android Studio çš„ SDK Manager æ‰€éœ€çš„ç›¸é—œå¥—ä»¶éƒ½æœ‰ä¸‹è¼‰å®‰è£ ï¼ï¼ï¼

1.  æ‰“é–‹ Genymotion
2.  æ‰¾åˆ° è¨­å®š > adb
3.  é¸æ“‡ Use custom Android SDK tools
4.  æ‰“é–‹ Android Studio æ‰¾åˆ° SDK Manager ä¸­çš„ SDK  æª”æ¡ˆè·¯å¾‘ï¼Œè¤‡è£½ä¸‹ä¾†

![Android Studio SDK Manager](assets/android-studio-sdk-manager.png)

![Android Studio SDK Path](assets/android-studio-sdk-path.png)

5.  å›åˆ° Genymotionï¼Œåœ¨ä¸‹é¢ Android SDK è¼¸å…¥æ¡†ä¸­å¡«å…¥ Android Studio çš„è·¯å¾‘

![genymotion-preference.png](assets/genymotion-preference.png)

![genymotion-adb-setting.png](assets/genymotion-adb-setting.png)

6.  é‡å•Ÿ Genymotionï¼Œé‡å•Ÿå¾Œè¨˜å¾—å†ä¾ç…§å‰é¢çš„ `å°‡æ¨¡æ“¬å™¨é€£æ¥åˆ° ReactNative VM ç’°å¢ƒ` æ­¥é©Ÿåšä¸€æ¬¡

ç”±æ–¼æ‚¨çš„æœ¬æ©Ÿå·²ç¶“æœ‰å…¨åŸŸçš„ adb äº†ï¼Œä¸éœ€è¦å†ä½¿ç”¨æ•™æçš„ adb æª”æ¡ˆä¾†åŸ·è¡ŒæŒ‡ä»¤ï¼Œ
ç›´æ¥ä½¿ç”¨å…¨åŸŸçš„ adb åŸ·è¡ŒæŒ‡ä»¤ï¼ŒæŒ‡ä»¤å¦‚ä¸‹

```bash
# é€²å…¥ä¸‹è¼‰çš„ adb æª”æ¡ˆæ‰€åœ¨ç›®éŒ„
$ adb devices
# åŸ·è¡Œå¾Œæœƒçœ‹åˆ° android æ¨¡æ“¬å™¨çš„ ip ä½å€(å¯èƒ½æ¯æ¬¡éƒ½æœƒä¸åŒ)ï¼Œè«‹å…ˆå°‡é€™å€‹ä½å€è¤‡è£½ä¸‹ä¾†ï¼Œå¾…æœƒæœƒç”¨åˆ°
$ adb tcpip 5556
```

## æ‰‹å‹•å–å¾— android è£ç½®ä½å€

åœ¨ `æœ¬æ©Ÿ` é›»è…¦åŸ·è¡ŒæŒ‡ä»¤(windows é›»è…¦ä½¿ç”¨å‘½ä»¤æç¤ºå­—å…ƒåŸ·è¡Œ)

> æœ¬æ©Ÿæœ‰å®‰è£ Android Studio çš„è«‹ç•¥éæ­¤æ­¥é©Ÿï¼Œä¸¦ç…§ä¸‹æ–¹ `å®‰è£å•é¡Œ adb ç‰ˆæœ¬è¡çª`ã€€çš„æ­¥é©Ÿè™•ç†ï¼Œè™•ç†å®Œå¾Œå†å›ä¾†å¾ `ç¬¬2é»ã€€åˆ° ReactNative è™›æ“¬æ©Ÿç¶²é ç•¶ä¸­çš„ terminal è¦–çª—è¼¸å…¥æŒ‡ä»¤`ã€€ç¹¼çºŒæ­¥é©Ÿ

```bash
# å…ˆé€²å…¥ Genymotion é™„è¨­çš„ adb æª”æ¡ˆæ‰€åœ¨çš„ç›®éŒ„
## windows åƒè€ƒè·¯å¾‘
cd C:\Program Files\Genymobile\Genymotion\tools
## macOS åƒè€ƒè·¯å¾‘
cd /Applications/Genymotion.app/Contents/MacOS/tools

# åŸ·è¡Œ adb æŒ‡ä»¤
$ adb devices
# åŸ·è¡Œå¾Œæœƒçœ‹åˆ° android æ¨¡æ“¬å™¨çš„ ip ä½å€(å¯èƒ½æ¯æ¬¡éƒ½æœƒä¸åŒ)ï¼Œè«‹å…ˆå°‡é€™å€‹ä½å€è¤‡è£½ä¸‹ä¾†ï¼Œå¾…æœƒæœƒç”¨åˆ°

# ä¿®æ”¹è£ç½® port è™Ÿåˆ° 5556
$ adb tcpip 5556
```

![](/Users/DMOON/cases/online-course/books/react-native-advanced/setup/assets/adb-device-ip.png)


## ç¢ºèªæ“ä½œæˆåŠŸ

ç”¨ç€è¦½å™¨é–‹å•Ÿ [localhost:9083](localhost:9083) ï¼Œåœ¨ cloud9 ç·¨è¼¯å™¨æ“ä½œä»‹é¢çš„ tab é–‹å•Ÿ Terminal çµ‚ç«¯æ©Ÿ

```bash
# æ–°å¢ä¸€å€‹ Terminal tab
cd RN_Todo_Sample
npm install
react-native start

# å¦é–‹ä¸€å€‹ Terminal tab
cd RN_Todo_Sample
react-native run-android
```

ç›¸é—œæ­¥é©Ÿå¯ä»¥åƒè€ƒå½±ç‰‡ https://youtu.be/2m7YyRycMhE?t=130 æ“ä½œ

## å¸¸è¦‹å•é¡Œ

### Kernel driver not installed (rc=-1908)

![virtual-box-kernel-driver-not-installed](assets/virtual-box-kernel-driver-not-installed.png)

é–‹å•Ÿ `ç³»çµ±åå¥½è¨­å®š (System Preferences)` ä¸­çš„ `å®‰å…¨æ€§èˆ‡éš±ç§æ¬Šï¼ˆSecurity & Privacyï¼‰`

å…è¨± `Oracle America, Inc.`

![allow-oracle-security](assets/allow-oracle-security.png)

### **Your CPU is incompatible with virtualization technologies**

![CPU is incompatible with virtualization technologies](assets/genymotion-error-cpu-incompatible.png)

é€²å…¥ BIOS è¨­å®šé–‹å•Ÿ CPU è™›æ“¬åŒ–

1. é‡æ–°é–‹æ©Ÿï¼ŒæŒ‰ä½ delete éµï¼Œé€²å…¥ BIOS
2. é€²å…¥é¸å–®ï¼šAdvanced Mode > Advanced > CPU Configuratio ï¼Œé–‹å•Ÿä»¥ä¸‹é¸é …
  - Virtualization Technology: Enabled
  - VT-x: Enabled

[å…¶ä»–å¸¸è¦‹å•é¡Œ](http://bbs.reactnative.cn/topic/130/%E6%96%B0%E6%89%8B%E6%8F%90%E9%97%AE%E5%89%8D%E5%85%88%E6%9D%A5%E8%BF%99%E9%87%8C%E7%9C%8B%E7%9C%8B-react-native%E7%9A%84%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98)



## å»¶ä¼¸é–±è®€

- å®˜æ–¹æ–‡ä»¶ Android é–‹ç™¼ç’°å¢ƒ - for Mac: [http://facebook.github.io/react-native/releases/0.44/docs/getting-started.html#android-development-environment](http://facebook.github.io/react-native/releases/0.44/docs/getting-started.html#android-development-environment)
- å®˜æ–¹æ–‡ä»¶ Android é–‹ç™¼ç’°å¢ƒ - for Windows: [http://facebook.github.io/react-native/releases/0.44/docs/getting-started.html#android-development-environment](http://facebook.github.io/react-native/releases/0.44/docs/getting-started.html#android-development-environment)
- ç°¡ä¸­ç’°å¢ƒæ•™å­¸: [http://reactnative.cn/docs/0.47/getting-started.html](http://reactnative.cn/docs/0.47/getting-started.html)

